{"apiVersion": "apps/v1", "kind": "Deployment", "metadata": {"name": "external-dns", "namespace": "external-dns"}, "spec": {"selector": {"matchLabels": {"app.kubernetes.io/name": "external-dns"}}, "strategy": {"type": "Recreate"}, "template": {"metadata": {"annotations": {"vault.hashicorp.com/agent-inject": "true", "vault.hashicorp.com/agent-inject-secret-cloudflare": "cloudflare", "vault.hashicorp.com/agent-inject-template-cloudflare": "{{- with secret \"kv/cloudflare\" -}}\nexport CF_API_TOKEN={{ .Data.data.token }}\n{{- end -}}\n", "vault.hashicorp.com/role": "external-dns"}, "labels": {"app.kubernetes.io/name": "external-dns"}}, "spec": {"containers": [{"args": ["set -euo pipefail\n\n. /vault/secrets/cloudflare\n\nexec external-dns \\\n--events \\\n--source=ingress \\\n--provider=cloudflare \\\n--txt-owner-id=mordor \\\n--txt-prefix=mordor_ \\\n--interval=30m\n"], "command": ["/bin/bash", "-c"], "image": "docker.io/bitnami/external-dns:0.14.0", "name": "external-dns", "resources": {"limits": {"cpu": "50m", "memory": "64Mi"}, "requests": {"cpu": "20m", "memory": "32Mi"}}}], "hostUsers": false, "serviceAccountName": "external-dns"}}}}
